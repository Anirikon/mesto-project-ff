(()=>{"use strict";function e(e){document.addEventListener("keydown",n),e.classList.add("popup_is-opened")}function t(e){e&&(e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n))}function o(e){var o=e.currentTarget;e.target===o&&t(o)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}var r={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"c61b35b3-df45-4438-93f5-d738502d68af","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function c(e,t,o,n,r,a,c,u){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=i.querySelector(".card__image"),d=i.querySelector(".card__title"),s=i.querySelector(".card__delete-button"),p=i.querySelector(".card__like-button"),_=i.querySelector(".card__like-counter");return l.src=e.link,d.textContent=e.name,l.alt=e.name,i.dataset.id=o,l.addEventListener("click",c),p.addEventListener("click",(function(){a(p,_)})),t===n?s.addEventListener("click",(function(){u(o,i)})):(t||void 0===n)&&s.remove(),0!==r.length&&(_.textContent=r.length),r.forEach((function(e){e._id===t&&p.classList.add("card__like-button_is-active")})),i}function u(e,t){var o;"card__like-button"===e.classList.value?(o=e.closest("[data-id]").dataset.id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:r.headers}).then(a)).then((function(o){t.textContent=o.likes.length,e.classList.add("card__like-button_is-active")})).catch((function(e){console.error("Ошибка при добавлении лайка:",e)})):"card__like-button card__like-button_is-active"===e.classList.value&&function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then(a)}(e.closest("[data-id]").dataset.id).then((function(o){t.textContent=o.likes.length,e.classList.remove("card__like-button_is-active"),0==o.likes.length&&(t.textContent="")})).catch((function(e){console.error("Ошибка при удалении лайка:",e)}))}function i(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function l(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}function d(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(o){i(e,o,t)}))}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}var p=document.querySelectorAll(".popup"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".profile__add-button"),y=_.querySelector(".popup__form"),m=_.querySelector(".popup__input_type_card-name"),v=_.querySelector(".popup__input_type_url"),b=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit"),S=document.querySelector(".places__list"),q=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),C=h.querySelector(".popup__form"),E=h.querySelector(".popup__input_type_name"),g=h.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_image"),x=k.querySelector(".popup__image"),A=k.querySelector(".popup__caption"),w=document.querySelector(".popup_type_delete-card"),T=w.querySelector(".popup__form"),U=document.querySelector(".profile__image"),j=document.querySelector(".profile__image__edit"),O=document.querySelector(".edit-profile-avatar"),D=O.querySelector(".popup__form"),P=O.querySelector(".popup__input_type_avatar"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function I(t){var o=t.target;x.src=o.src,A.textContent=o.alt,e(k)}function N(o,n){T.querySelector(".popup__button").dataset.loader="ready-to-download",e(w),T.onsubmit=function(e){J(!0),e.preventDefault(),function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then(a)}(o).then((function(){!function(e){e.remove(),e=null}(n),t(w)})).catch((function(e){console.error("Ошибка при удалении карточки:",e)})).finally((function(){J(!1)}))}}function M(e){document.querySelectorAll(".popup__button").forEach((function(e){e.removeAttribute("data-loader")})),e.reset()}function J(e){var t=document.querySelector("[data-loader]"),o=document.createElement("span");o.className="loading-indicator",o.textContent="...",e&"Сохранить"===t.textContent?(t.disabled=!0,t.classList.add("popup__button_disabled"),t.textContent="Сохранение",t.append(o),o.classList.add("popup__button-loading")):e&"Да"===t.textContent?(t.disabled=!0,t.classList.add("popup__button_disabled"),t.textContent="Удаление",t.append(o),o.classList.add("popup__button-loading")):!1===e&"Сохранение..."===t.textContent?(o.classList.remove("popup__button-loading"),t.textContent="Сохранить",delete t.dataset.loader,o.remove()):!1===e&"Удаление..."===t.textContent&&(o.classList.remove("popup__button-loading"),t.textContent="Да",delete t.dataset.loader,o.remove(),t.disabled=!1,t.classList.remove("popup__button_disabled"))}f.addEventListener("click",(function(){M(y),d(y,B),_.querySelector(".popup__button").dataset.loader="ready-to-download",_.querySelector(".popup__button").classList.add("popup__button_disabled"),_.querySelector(".popup__button").disabled=!0,e(_)})),b.addEventListener("click",(function(){M(C),E.value=q.textContent,g.value=L.textContent,h.querySelector(".popup__button").dataset.loader="ready-to-download",h.querySelector(".popup__button").classList.add("popup__button_disabled"),h.querySelector(".popup__button").disabled=!0,d(C,B),e(h)})),C.addEventListener("submit",(function(e){var o,n;e.preventDefault(),J(!0),(o=E.value,n=g.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:o,about:n})}).then(a)).then((function(e){q.textContent=e.name,L.textContent=e.about,t(h)})).catch((function(e){console.error("Ошибка при сохранении данных профиля:",e)})).finally((function(){J(!1)}))})),y.addEventListener("submit",(function(e){e.preventDefault(),J(!0);var o,n,i={name:m.value,link:v.value};(o=m.value,n=v.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:o,link:n})}).then(a)).then((function(e){var o=c(i,e.owner._id,e._id,e.owner._id,e.likes,u,I,N);S.prepend(o),t(_)})).catch((function(e){console.error("Ошибка при сохранении новой карточки:",e)})).finally((function(){J(!1)}))})),D.addEventListener("submit",(function(e){var o;e.preventDefault(),J(!0),(o=P.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:o})}).then(a)).then((function(e){U.style.backgroundImage="url(".concat(e.avatar,")"),t(O)})).catch((function(e){console.error("Ошибка при сохранении аватара:",e)})).finally((function(){J(!1)}))})),j.addEventListener("click",(function(){M(D),d(D,B),O.querySelector(".popup__button").dataset.loader="ready-to-download",O.querySelector(".popup__button").classList.add("popup__button_disabled"),O.querySelector(".popup__button").disabled=!0,e(O)})),p.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){t(e)})),e.addEventListener("mousedown",o),e.classList.add("popup_is-animated")})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);l(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?i(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));if(r.classList.add(n.errorClass),t.classList.add(n.inputErrorClass),t.validity.patternMismatch){var a=t.dataset.errorMessage;r.textContent=a}else r.textContent=o}(e,t,t.validationMessage,o)}(e,r,t),l(o,n,t)}))}))}(t,e)}))}(B),Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{method:"GET",headers:r.headers}).then(a),fetch("".concat(r.baseUrl,"/cards"),{method:"GET",headers:r.headers}).then(a)]).then((function(e){var t,o,n=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,a,c,u=[],i=!0,l=!1;try{if(a=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=a.call(o)).done)&&(u.push(n.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=o.return&&(c=o.return(),Object(c)!==c))return}finally{if(l)throw r}}return u}}(t,o)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?s(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],a=n[1];U.style.backgroundImage="url(".concat(r.avatar,")"),q.textContent=r.name,L.textContent=r.about,a.forEach((function(e){var t=c(e,r._id,e._id,e.owner._id,e.likes,u,I,N);S.append(t)}))})).catch((function(e){console.error("Ошибка при загрузке информации о пользователе или информации о карточках:",e)}))})();